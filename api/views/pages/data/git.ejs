<div class="hero fade-in">
    <h1><i class="bi bi-github"></i> My GitHub Data</h1>
    <p class="lead">View my GitHub profile, repositories, and organizations</p>
</div>

<div class="row">
    <div class="col-lg-10 mx-auto">
        <div class="card">
            <h2 class="card-title">GitHub Profile</h2>

            <div class="btn-group mb-4">
                <button type="button" class="btn btn-info active" onclick="loadData('user')" id="btn-user">
                    <i class="bi bi-person"></i> Profile
                </button>
                <button type="button" class="btn btn-success" onclick="loadData('repos')" id="btn-repos">
                    <i class="bi bi-folder"></i> Repositories
                </button>
                <button type="button" class="btn btn-warning" onclick="loadData('orgs')" id="btn-orgs">
                    <i class="bi bi-building"></i> Organizations
                </button>
            </div>

            <div id="result" class="result-container">
                <div class="loading"><i class="bi bi-hourglass-split"></i> Loading GitHub data...</div>
            </div>
        </div>

        <div class="card mt-4">
            <h3 class="card-title">API Endpoints</h3>
            <div class="code-block">
                <h4>Get my profile:</h4>
                <pre><code>curl -s <%= baseUrl %>/api/v1/me/info/github</code></pre>
            </div>
            <div class="code-block">
                <h4>Get my repositories:</h4>
                <pre><code>curl -s <%= baseUrl %>/api/v1/me/info/github/repos</code></pre>
            </div>
            <div class="code-block">
                <h4>Get my organizations:</h4>
                <pre><code>curl -s <%= baseUrl %>/api/v1/me/info/github/orgs</code></pre>
            </div>
        </div>
    </div>
</div>

<style>
.github-profile {
    padding: 1rem;
}

.profile-header {
    display: flex;
    align-items: center;
    gap: 1.5rem;
    margin-bottom: 1.5rem;
}

.avatar {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    border: 3px solid var(--purple);
}

.profile-info h4 {
    margin: 0 0 0.5rem 0;
    color: var(--purple);
}

.profile-stats {
    display: flex;
    gap: 2rem;
    margin: 1.5rem 0;
    padding: 1rem;
    background: var(--bg-secondary);
    border-radius: var(--radius-md);
}

.stat {
    text-align: center;
}

.stat strong {
    display: block;
    font-size: 1.5rem;
    color: var(--purple);
}

.stat span {
    color: var(--text-secondary);
    font-size: 0.875rem;
}

.profile-details {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    margin: 1rem 0;
}

.profile-details span {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--text-secondary);
}

.profile-details i {
    color: var(--cyan);
}

.repos-list, .orgs-list {
    display: grid;
    gap: 1rem;
}

.repo-item {
    padding: 1.25rem;
    background: var(--bg-secondary);
    border-radius: var(--radius-md);
    border: 1px solid var(--border-color);
    transition: border-color 0.2s;
}

.repo-item:hover {
    border-color: var(--purple);
}

.repo-item h5 {
    margin: 0 0 0.5rem 0;
}

.repo-item h5 a {
    color: var(--cyan);
    text-decoration: none;
}

.repo-item h5 a:hover {
    text-decoration: underline;
}

.repo-meta {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-top: 0.75rem;
    font-size: 0.875rem;
    color: var(--text-secondary);
}

.repo-meta i {
    color: var(--yellow);
}

.org-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: var(--bg-secondary);
    border-radius: var(--radius-md);
    border: 1px solid var(--border-color);
}

.org-avatar {
    width: 50px;
    height: 50px;
    border-radius: var(--radius-md);
}

.org-info h5 {
    margin: 0 0 0.25rem 0;
}

.org-info h5 a {
    color: var(--cyan);
    text-decoration: none;
}

.loading {
    text-align: center;
    padding: 3rem;
    color: var(--cyan);
}

.error {
    text-align: center;
    padding: 2rem;
    color: var(--red);
    background: rgba(255, 85, 85, 0.1);
    border-radius: var(--radius-md);
}

.btn-group .btn.active {
    opacity: 1;
}

.btn-group .btn:not(.active) {
    opacity: 0.7;
}

@media (max-width: 768px) {
    .profile-header {
        flex-direction: column;
        text-align: center;
    }

    .profile-stats {
        justify-content: center;
    }

    .btn-group {
        flex-direction: column;
    }

    .btn-group .btn {
        width: 100%;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    loadData('user');
});

async function loadData(type) {
    const resultDiv = document.getElementById('result');

    // Update button states
    document.querySelectorAll('.btn-group .btn').forEach(btn => btn.classList.remove('active'));
    document.getElementById('btn-' + type).classList.add('active');

    resultDiv.innerHTML = '<div class="loading"><i class="bi bi-hourglass-split"></i> Loading...</div>';

    try {
        let url;
        if (type === 'repos') {
            url = '/api/v1/me/info/github/repos';
        } else if (type === 'orgs') {
            url = '/api/v1/me/info/github/orgs';
        } else {
            url = '/api/v1/me/info/github';
        }

        const response = await fetch(url);
        const data = await response.json();

        if (response.ok) {
            displayData(data, type);
        } else {
            resultDiv.innerHTML = `<div class="error"><i class="bi bi-exclamation-triangle"></i> ${data.error || 'Failed to load data'}</div>`;
        }
    } catch (error) {
        console.error('Error:', error);
        resultDiv.innerHTML = '<div class="error"><i class="bi bi-exclamation-triangle"></i> Error loading GitHub data</div>';
    }
}

function displayData(data, type) {
    const resultDiv = document.getElementById('result');
    let html = '';

    if (type === 'user') {
        const user = data;
        html = `
            <div class="github-profile">
                <div class="profile-header">
                    <img src="${user.avatar_url}" alt="${user.login}" class="avatar">
                    <div class="profile-info">
                        <h4>${user.name || user.login}</h4>
                        <p class="text-muted">@${user.login}</p>
                        ${user.bio ? `<p>${user.bio}</p>` : ''}
                    </div>
                </div>
                <div class="profile-stats">
                    <div class="stat">
                        <strong>${user.public_repos || 0}</strong>
                        <span>Repositories</span>
                    </div>
                    <div class="stat">
                        <strong>${user.followers || 0}</strong>
                        <span>Followers</span>
                    </div>
                    <div class="stat">
                        <strong>${user.following || 0}</strong>
                        <span>Following</span>
                    </div>
                </div>
                <div class="profile-details">
                    ${user.location ? `<span><i class="bi bi-geo-alt"></i> ${user.location}</span>` : ''}
                    ${user.company ? `<span><i class="bi bi-building"></i> ${user.company}</span>` : ''}
                    ${user.blog ? `<span><i class="bi bi-link-45deg"></i> <a href="${user.blog}" target="_blank">${user.blog}</a></span>` : ''}
                </div>
                <a href="${user.html_url}" target="_blank" class="btn btn-primary mt-3">
                    <i class="bi bi-github"></i> View on GitHub
                </a>
            </div>
        `;
    } else if (type === 'repos') {
        const repos = Array.isArray(data) ? data : [];
        if (repos.length > 0) {
            html = `<p class="text-muted mb-3">Found ${repos.length} repositories</p><div class="repos-list">`;
            repos.slice(0, 20).forEach(repo => {
                html += `
                    <div class="repo-item">
                        <h5><a href="${repo.html_url}" target="_blank">${repo.name}</a></h5>
                        ${repo.description ? `<p class="text-muted mb-2">${repo.description}</p>` : ''}
                        <div class="repo-meta">
                            ${repo.language ? `<span class="badge bg-primary">${repo.language}</span>` : ''}
                            <span><i class="bi bi-star-fill"></i> ${repo.stargazers_count || 0}</span>
                            <span><i class="bi bi-diagram-2-fill"></i> ${repo.forks_count || 0}</span>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            if (repos.length > 20) {
                html += `<p class="text-muted mt-3">Showing first 20 of ${repos.length} repositories</p>`;
            }
        } else {
            html = '<div class="error">No repositories found</div>';
        }
    } else if (type === 'orgs') {
        const orgs = Array.isArray(data) ? data : [];
        if (orgs.length > 0) {
            html = `<p class="text-muted mb-3">Member of ${orgs.length} organizations</p><div class="orgs-list">`;
            orgs.forEach(org => {
                html += `
                    <div class="org-item">
                        <img src="${org.avatar_url}" alt="${org.login}" class="org-avatar">
                        <div class="org-info">
                            <h5><a href="https://github.com/${org.login}" target="_blank">${org.login}</a></h5>
                            ${org.description ? `<p class="text-muted mb-0">${org.description}</p>` : ''}
                        </div>
                    </div>
                `;
            });
            html += '</div>';
        } else {
            html = '<div class="error">No organizations found</div>';
        }
    }

    resultDiv.innerHTML = html;
}
</script>
